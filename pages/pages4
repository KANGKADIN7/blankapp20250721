import streamlit as st
import numpy as np
import matplotlib.pyplot as plt

st.set_page_config(page_title="ê¸‰ì‹ íƒ„ì†Œë°œìêµ­ ê³„ì‚°ê¸°", layout="centered")

# ğŸ‘‰ ì‚¬ì´ë“œë°”ì— í•™ìƒ ì´ë¦„ ì…ë ¥
student_name = st.sidebar.text_input("ğŸ‘¤ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”", value="")

if "page" not in st.session_state:
    st.session_state.page = "intro"

def go_to_main():
    st.session_state.page = "main"

if st.session_state.page == "intro":
    st.markdown(
        """
        <div style='text-align:center; padding:60px; background: linear-gradient(#f3e7f9, white); border-radius: 20px;'>
            <h2 style='font-size: 2.2em;'>ì˜¤ëŠ˜ ë¨¹ì€ ê¸‰ì‹,<br>íƒ„ì†Œë°œìêµ­ í™•ì¸í•´ë³¼ê¹Œ?</h2>
            <br>
            <button style='background-color:#9b7dea; color:white; font-size: 1.1em; padding: 12px 30px; border:none; border-radius:10px;' onclick='document.querySelector("button[type=submit]").click();'>ğŸ½ï¸ ì œì¶œí•˜ëŸ¬ ê°€ê¸°</button>
        </div>
        """,
        unsafe_allow_html=True,
    )
    st.button("ğŸ½ï¸ ì œì¶œí•˜ëŸ¬ ê°€ê¸°", on_click=go_to_main)

elif st.session_state.page == "main":
    st.header("ğŸ“‹ ê¸‰ì‹ íƒ„ì†Œë°œìêµ­ ê³„ì‚°ê¸°")

    # ì´ë¦„ í‘œì‹œ
    if student_name:
        st.subheader(f"ğŸ‘‹ ì•ˆë…•í•˜ì„¸ìš”, **{student_name}** í•™ìƒ!")

    st.write("ìŒì‹ ì”ë°˜ì´ ì–¼ë§ˆë‚˜ ìˆì—ˆë‚˜ìš”? (0~3ì  ì²™ë„)")

    # ì”ë°˜ ìŠ¬ë¼ì´ë”
    rice = st.slider("ğŸš ë°¥ì„ ì–¼ë§ˆë‚˜ ë‚¨ê²¼ë‚˜ìš”?", 0, 3, 0, 1)
    meat = st.slider("ğŸ¥© ê³ ê¸°ë¥¼ ì–¼ë§ˆë‚˜ ë‚¨ê²¼ë‚˜ìš”?", 0, 3, 0, 1)
    fish = st.slider("ğŸŸ ìƒì„ ì„ ì–¼ë§ˆë‚˜ ë‚¨ê²¼ë‚˜ìš”?", 0, 3, 0, 1)
    kimchi = st.slider("ğŸ¥¬ ê¹€ì¹˜ ë“±ì„ ì–¼ë§ˆë‚˜ ë‚¨ê²¼ë‚˜ìš”?", 0, 3, 0, 1)

    total_score = rice + meat + fish + kimchi
    co2_emission = rice * 0.5 + meat * 0.9 + fish * 0.8 + kimchi * 0.2

    if st.button("ğŸŒ¿ íƒ„ì†Œë°°ì¶œëŸ‰ ë³´ê¸°"):
        st.markdown(f"<h3 style='text-align:center;'>ğŸ’¨ ë‹¹ì‹ ì˜ í•œ ë¼ ê¸‰ì‹ì€ <span style='color:#9b7dea'>{co2_emission:.1f} kg COâ‚‚eq</span> ë°°ì¶œí–ˆì–´ìš”!</h3>", unsafe_allow_html=True)

        # ì ìˆ˜ëŒ€ë³„ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ë§
        if total_score <= 2:
            st.success("ğŸŒ± **í›Œë¥­í•´ìš”!** ì”ë°˜ì´ ê±°ì˜ ì—†ë„¤ìš”. ì§€êµ¬ê°€ í™˜í•˜ê²Œ ì›ƒê³  ìˆì–´ìš” ğŸ˜Š", icon="âœ…")
            st.markdown("<div style='background-color:#e7f9e7; padding:15px; border-radius:10px;'>ğŸŒ¿ <b>ì§€ì† ê°€ëŠ¥ì„± ìµœê³ !</b> ë‚´ì¼ë„ ì´ë ‡ê²Œë§Œ ë¨¹ìœ¼ë©´ ì§€êµ¬ë„ ê±´ê°•í•´ì ¸ìš”.</div>", unsafe_allow_html=True)
        elif total_score <= 5:
            st.info("ğŸ™‚ **ì¢‹ì•„ìš”!** ì¡°ê¸ˆ ë‚¨ê¸°ê¸´ í–ˆì§€ë§Œ ê½¤ ì˜í–ˆì–´ìš”.", icon="ğŸ‘Œ")
            st.markdown("<div style='background-color:#f3f0e3; padding:15px; border-radius:10px;'>ğŸ½ <b>ì¡°ê¸ˆë§Œ ë” ë…¸ë ¥í•˜ë©´ ì™„ë²½í•´ìš”!</b> ë‚´ì¼ì€ ë” ì¤„ì—¬ë´ìš”!</div>", unsafe_allow_html=True)
        elif total_score <= 8:
            st.warning("ğŸ˜• **ì¡°ê¸ˆ ë§ì´ ë‚¨ê²¼ì–´ìš”.** ì‹ì‚¬ëŸ‰ì„ ì¡°ì ˆí•´ë³´ë©´ ì–´ë•Œìš”?", icon="âš ï¸")
            st.markdown("<div style='background-color:#fff3cd; padding:15px; border-radius:10px;'>ğŸ¥• <b>ìŒì‹ ë‚­ë¹„ëŠ” ê³§ íƒ„ì†Œ ë‚­ë¹„!</b> ì¡°ê¸ˆë§Œ ë” ì‹ ê²½ ì¨ë³´ë©´ ì¢‹ì•„ìš”!</div>", unsafe_allow_html=True)
        else:
            st.error("ğŸš¨ **í™˜ê²½ ë¹„ìƒ!** ì”ë°˜ì´ ë„ˆë¬´ ë§ì•„ìš”!", icon="â›”")
            st.markdown("<div style='background-color:#f8d7da; padding:15px; border-radius:10px;'>ğŸ”¥ <b>ì´ëŒ€ë¡œ ê°€ë©´ ì§€êµ¬ê°€ ì•„íŒŒìš”.</b> ê¼­ ë‚´ì¼ë¶€í„° ì‹¤ì²œí•´ë´ìš”!</div>", unsafe_allow_html=True)

        # ê·¸ë˜í”„
        days = ["Mon", "Tue", "Wed", "Thu", "Fri"]
        values = np.random.uniform(1.5, 3.5, size=5)
        values[-1] = co2_emission

        fig, ax = plt.subplots()
        ax.bar(days, values, color=["#f4c430", "#ff7f50", "#87cefa", "#6495ed", "#9b7dea"])
        ax.set_title("ğŸ“Š ìŒì‹ë¬¼ íƒ„ì†Œ ë°°ì¶œëŸ‰", fontsize=14)
        ax.set_ylabel("kg COâ‚‚eq")
        st.pyplot(fig)

        st.caption("âœ… ë‚´ì¼ì€ ì–´ë–¤ ì„ íƒì„ í•´ë³¼ ìˆ˜ ìˆì„ê¹Œìš”?")
